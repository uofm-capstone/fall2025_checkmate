<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Page with Sidebar</title>
  <style>
    .sidebar {
      width: 250px;
      height: 100%;
      padding: 1rem;
      overflow-y: auto;
      background-color: #f8f9fa;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .sidebar h2, .sidebar h3, .sidebar h5 {
      color: #343a40;
    }
    .sidebar a {
      color: #343a40;
    }
    .sidebar .btn-primary {
      background-color: #0d6efd;
      border-color: #0d6efd;
      color: #ffffff;
    }

    @media (max-width: 992px) {
      .sidebar {
        display: none;
      }
    }

    .main-content {
      flex: 1;
      border: 2px solid #ffffff;
      border-radius: 10px;
      padding: 20px;
    }

    .top-warning {
      position: fixed;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      z-index: 1050;
    }
  </style>
</head>
<body>

  <div class="container mt-3">
    <div class="d-flex">
      <div class="main-content">
        <!-- Warning for No Student CSV Uploaded -->
        <% unless @semester.student_csv.attached? %>
          <div class="d-flex justify-content-center mt-4 mb-4">
            <div class="card w-100 border-danger">
              <div class="card-body bg-danger text-white">
                <p class="card-text text-center">
                  <strong>Attention:</strong> No Student CSV has been uploaded for this semester. Please upload the student csv to display the data
                </p>
              </div>
            </div>
          </div>
        <% end %>

        <div class="row">
          <div class="mt-4 text-center">
            <% if team_exist(@teams) %>
              <h2 class="">Team Status</h2>
              <div class="mt-3 mb-3">
                <h5 class="">Legend:</h5>
                <ul class="list-inline">
                  <li class="list-inline-item">
                    <%= image_tag "check-circle-fill.svg", style: "height:16px" %> All Good
                  </li>
                  <li class="list-inline-item">
                    <%= image_tag "question-circle-fill.svg", style: "height:16px" %> No Data Uploaded
                  </li>
                  <li class="list-inline-item">
                    <%= image_tag "exclamation-circle-fill-yellow.svg", style: "height:16px" %> No Client Survey
                  </li>
                  <li class="list-inline-item">
                    <%= image_tag "exclamation-triangle-fill-red.svg", style: "height:16px" %> Poor Performance
                  </li>
                </ul>
              </div>
              <p>Note: Hover over warning symbol to see more details</p>

              <!-- Warning for No Client CSV Uploaded -->
              <% unless @semester.client_csv.attached? %>
                <div class="d-flex justify-content-center mt-4 mb-4">
                  <div class="card w-100 border-danger">
                    <div class="card-body bg-danger text-white">
                      <p class="card-text text-center">
                        <strong>Attention:</strong> No Client CSV has been uploaded for this semester. Please upload the client csv to display the correct data.
                      </p>
                    </div>
                  </div>
                </div>
              <% end %>

              <table class="table table-bordered">
                <thead class="text-center">
                  <tr>
                    <th rowspan="3">Team</th>
                    <% @sprint_list.each do |sprint| %>
                      <th colspan="15"><%= sprint %></th>
                    <% end %>
                  </tr>
                  <tr>
                    <% @sprint_list.each do |_sprint| %>
                      <th colspan="4">Planning</th>
                      <th colspan="4">PC</th>
                      <th colspan="6">Demo</th>
                      <th rowspan="2">CF</th>
                    <% end %>
                  </tr>
                  <tr>
                    <% @sprint_list.each do |_sprint| %>
                      <% ["FS&D", "FA", "TE", "KU", "TS", "PP", "CC", "SR", "TSP", "PP", "PF", "CC", "SR", "D"].each do |item| %>
                        <th style="font-size: 0.75rem;"><%= item %></th>
                      <% end %>
                    <% end %>
                  </tr>
                </thead>
                <tbody>
                  <% @teams.each do |team| %>
                    <tr>
                      <td><%= team %></td>
                      <% @sprint_list.each do |sprint| %>
                        <% indicators = @flags[sprint][team] || [] %>
                        <% ["FS&D", "FA", "TE", "KU", "TS", "PP", "CC", "SR", "TSP", "PP", "PF", "CC", "SR", "D", "CF"].each do |rubric_item| %>
                          <td class="text-center">
                            <% if indicators.include?("no data") %>
                              <%= image_tag "question-circle-fill.svg", style: "height:16px" %>
                            <% elsif indicators.include?("no client score") && rubric_item == "CF" %>
                              <%= image_tag "exclamation-circle-fill-yellow.svg", style: "height:16px" %>
                            <% elsif indicators.include?("low score") || indicators.include?("low client score") %>
                              <%= image_tag "exclamation-triangle-fill-red.svg", style: "height:16px" %>
                            <% else %>
                              <%= image_tag "check-circle-fill.svg", style: "height:16px" %>
                            <% end %>
                          </td>
                        <% end %>
                      <% end %>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            <% end %>
          </div>
        </div>
      <!-- Sprint-specific Upload CSV Forms -->
<!-- Sprint-specific Upload CSV Forms (Student + Client, no Git) -->
<% @sprint_list.each do |sprint| %>
  <div class="d-flex justify-content-center mb-3">
    <div class="card w-100">
      <div class="card-body">
        <h5 class="card-title"><%= sprint %> CSV Upload</h5>
        <%= form_with url: upload_sprint_csv_semester_path(@semester), method: :post, local: true, html: { multipart: true } do %>
          <%= hidden_field_tag :sprint_name, sprint %>

          <div class="row">
            <div class="col-md-6">
              <label>Student CSV</label>
              <%= file_field_tag :student_csv, accept: '.csv', class: 'form-control' %>
            </div>
            <div class="col-md-6">
              <label>Client CSV</label>
              <%= file_field_tag :client_csv, accept: '.csv', class: 'form-control' %>
            </div>
          </div>

          <div class="text-center mt-3">
            <%= submit_tag "Upload for #{sprint}", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>


      </div>
    </div>
  </div>

  <!-- Upload CSV Modal -->
  <%= javascript_include_tag 'survey_page/survey_scroll_navigation' %>
  <%= javascript_include_tag 'survey_page/survey_page_expanding_cols' %>
  <%= javascript_include_tag 'octokit', type: "module" %>
</body>
</html>
