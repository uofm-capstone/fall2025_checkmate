<% teams_collection = (local_assigns[:teams] || @teams || Team.none).order(:name) %>

<%= bootstrap_form_with model: student, local: true do |f| %>
  <% if student.errors.any? %>
    <div class="alert alert-danger">
      <strong><%= pluralize(student.errors.count, "error") %></strong> prevented this student from being saved:
      <ul class="mb-0">
        <% student.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.text_field  :full_name,       label: "Full Name",       required: true, autocomplete: "off" %>
    <%= f.email_field :email,           label: "Email",           required: true, autocomplete: "off" %>
    <%= f.text_field  :github_username, label: "GitHub Username", required: true, autocomplete: "off" %>

    <%# --- Team dropdown (always present) --- %>
    <% if teams_collection.any? %>
      <%= f.collection_select :team_id,
            teams_collection, :id, :name,
            { label: "Team", include_blank: "Select a team" },
            { class: "form-select" } %>
    <% else %>
      <%= f.select :team_id,
            [],
            { label: "Team", include_blank: "No teams available" },
            { class: "form-select", disabled: true } %>
      <small class="form-text text-muted">
        No teams found. Create a team first, then return to assign one.
      </small>
    <% end %>
    <%# --- end Team dropdown --- %>
  </div>

  <div class="mt-3 d-flex gap-2">
    <%= f.submit student.persisted? ? "Save Changes" : "Create Student", class: "btn btn-primary" %>
    <% if local_assigns[:cancel_path].present? %>
      <%= link_to "Cancel", cancel_path, class: "btn btn-outline-secondary" %>
    <% end %>
  </div>
<% end %>
